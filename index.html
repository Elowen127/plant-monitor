<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlantCare | æˆé•·æ—¥è¨˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f0f4f0; }
        .plant-float { animation: floating 3s ease-in-out infinite; }
        @keyframes floating { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
    </style>
</head>
<body class="pb-20">

    <nav class="bg-white p-4 shadow-sm sticky top-0 z-50">
        <div class="max-w-md mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold text-green-600">ğŸŒ¿ æ¤ç‰©å°å¤¥ä¼´</h1>
            <button onclick="clearHistory()" class="text-xs text-red-400">æ¸…é™¤ç´€éŒ„</button>
        </div>
    </nav>

    <main class="max-w-md mx-auto p-4 space-y-6">
        
        <section class="bg-white rounded-3xl p-6 shadow-md text-center">
            <div id="plant-display" class="text-8xl mb-4 plant-float">ğŸŒµ</div>
            <h2 id="plant-name" class="text-2xl font-bold text-gray-800">å°ä»™ä»™</h2>
            <p id="status-text" class="text-blue-500 font-medium mt-2">ç‹€æ…‹ï¼šæª¢æŸ¥ä¸­...</p>
        </section>

        <section class="grid grid-cols-3 gap-4">
            <div class="bg-white p-4 rounded-2xl shadow-sm text-center">
                <span class="block text-gray-400 text-xs mb-1">æº«åº¦</span>
                <span id="curr-temp" class="text-lg font-bold text-orange-500">--Â°C</span>
            </div>
            <div class="bg-white p-4 rounded-2xl shadow-sm text-center">
                <span class="block text-gray-400 text-xs mb-1">æ¿•åº¦</span>
                <span id="curr-humi" class="text-lg font-bold text-blue-500">--%</span>
            </div>
            <div class="bg-white p-4 rounded-2xl shadow-sm text-center">
                <span class="block text-gray-400 text-xs mb-1">ç´€éŒ„æ•¸</span>
                <span id="record-count" class="text-lg font-bold text-green-500">0</span>
            </div>
        </section>

        <section class="bg-white rounded-3xl p-6 shadow-md">
            <h3 class="font-bold text-gray-700 mb-4 text-sm">æ­·å²æº«æ¿•åº¦è¶¨å‹¢</h3>
            <canvas id="historyChart" height="200"></canvas>
        </section>

        <div class="space-y-3">
            <button onclick="simulateSensor()" class="w-full bg-green-500 text-white py-3 rounded-2xl font-bold shadow-lg">
                æ¨¡æ“¬æ„Ÿæ¸¬å™¨ä¸Šå‚³è³‡æ–™
            </button>
            <p class="text-center text-gray-400 text-xs text-balance">æŒ‰ä¸€ä¸‹æŒ‰éˆ•ï¼Œå°±æœƒå„²å­˜ä¸€ç­†è³‡æ–™åˆ°æ‰‹æ©Ÿ/é›»è…¦çš„è¨˜æ†¶é«”ä¸­ã€‚</p>
        </div>

    </main>

    <script>
        let myChart;
        
        // 1. åˆå§‹åŒ–ç¶²é 
        window.onload = function() {
            initChart();
            loadHistory();
        };

        // 2. åˆå§‹åŒ–åœ–è¡¨
        function initChart() {
            const ctx = document.getElementById('historyChart').getContext('2d');
            myChart = new Chart(ctx, {
                type: 'line',
                data: { labels: [], datasets: [
                    { label: 'æ¿•åº¦', borderColor: '#3b82f6', data: [], tension: 0.4 },
                    { label: 'æº«åº¦', borderColor: '#f97316', data: [], tension: 0.4 }
                ]},
                options: { responsive: true, plugins: { legend: { display: false } } }
            });
        }

        // 3. æ¨¡æ“¬æ„Ÿæ¸¬å™¨å‹•ä½œ (æŒ‰ä¸‹æŒ‰éˆ•è§¸ç™¼)
        function simulateSensor() {
            const temp = Math.floor(Math.random() * (32 - 20 + 1)) + 20; // 20-32åº¦
            const humi = Math.floor(Math.random() * (80 - 30 + 1)) + 30; // 30-80%
            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

            saveData(time, temp, humi);
        }

        // 4. å„²å­˜è³‡æ–™åˆ° LocalStorage
        function saveData(time, temp, humi) {
            let history = JSON.parse(localStorage.getItem('plantHistory')) || [];
            
            const newRecord = { time, temp, humi };
            history.push(newRecord);

            // åªä¿ç•™æœ€è¿‘ 15 ç­†ï¼Œé¿å…æ‰‹æ©Ÿè·‘ä¸å‹•
            if (history.length > 15) history.shift();

            localStorage.setItem('plantHistory', JSON.stringify(history));
            loadHistory(); // é‡æ–°æ¸²æŸ“ç•«é¢
        }

        // 5. è®€å–ä¸¦é¡¯ç¤ºè³‡æ–™
        function loadHistory() {
            let history = JSON.parse(localStorage.getItem('plantHistory')) || [];
            
            // æ›´æ–°å³æ™‚æ•¸å­—é¡¯ç¤º
            if (history.length > 0) {
                const last = history[history.length - 1];
                document.getElementById('curr-temp').innerText = last.temp + 'Â°C';
                document.getElementById('curr-humi').innerText = last.humi + '%';
                document.getElementById('record-count').innerText = history.length;
                
                // åˆ¤æ–·æ¤ç‰©ç‹€æ…‹
                const statusEl = document.getElementById('status-text');
                const plantEl = document.getElementById('plant-display');
                if (last.humi < 40) {
                    statusEl.innerText = "ç‹€æ…‹ï¼šæˆ‘å¿«æ¸´æ­»äº†ï¼ğŸ’§";
                    statusEl.className = "text-red-500 font-bold mt-2";
                    plantEl.innerText = "ğŸ¥€";
                } else {
                    statusEl.innerText = "ç‹€æ…‹ï¼šæˆ‘å¾ˆèˆ’æœï¼Œè¬è¬ä¸»äºº âœ¨";
                    statusEl.className = "text-green-500 font-medium mt-2";
                    plantEl.innerText = "ğŸŒµ";
                }
            }

            // æ›´æ–°åœ–è¡¨
            myChart.data.labels = history.map(h => h.time);
            myChart.data.datasets[0].data = history.map(h => h.humi);
            myChart.data.datasets[1].data = history.map(h => h.temp);
            myChart.update();
        }

        // 6. æ¸…é™¤ç´€éŒ„åŠŸèƒ½
        function clearHistory() {
            if(confirm('ç¢ºå®šè¦åˆªé™¤æ‰€æœ‰æˆé•·ç´€éŒ„å—ï¼Ÿ')) {
                localStorage.removeItem('plantHistory');
                location.reload();
            }
        }
    </script>
</body>
</html>